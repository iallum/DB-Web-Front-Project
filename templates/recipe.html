<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Recipes</title>
    <style>
      body { font-family: system-ui, Arial, sans-serif; margin: 0; padding: 0 16px 80px; }
      header { display:flex; align-items:center; gap:12px; padding:16px 0; }
      .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(260px,1fr)); gap:16px; }
      .card { border:1px solid #ddd; border-radius:10px; padding:14px; text-decoration:none; color:inherit; display:block; }
      .card:hover { box-shadow:0 2px 10px rgba(0,0,0,.08); }
      .title { font-weight:700; margin:0 0 8px; }
      .rating { opacity:.8; font-size:.95rem; }
      .pagination { display:flex; gap:8px; justify-content:center; margin:24px 0; }
      .pagination a, .pagination span { padding:8px 12px; border:1px solid #ddd; border-radius:8px; text-decoration:none; color:inherit; }
      .pagination .current { background:#f5f5f5; }
      .searchbar { margin: 8px 0 16px; }
      .searchbar input { width:100%; max-width:420px; padding:10px; border:1px solid #ddd; border-radius:8px; }
    </style>
  </head>
  <body>
    <header>
      <a href="/">← Home</a>
      <h1 style="margin:0;">Recipes</h1>
    </header>

    <form class="searchbar" method="get" action="/recipes">
      <input type="text" name="q" placeholder="Search recipes…" value="{{ q or '' }}" />
      <input type="hidden" name="per_page" value="{{ per_page }}" />
    </form>

    {% if recipes|length == 0 %}
      <p>No recipes found.</p>
    {% else %}
      <div class="grid">
        {% for r in recipes %}
          <a class="card" href="/recipes/{{ r.recipe_id }}">
            <p class="title">{{ r.title }}</p>
            {% if r.avg_rating is not none %}
              <p class="rating">⭐ {{ "%.1f"|format(r.avg_rating) }}</p>
            {% endif %}
            {% if r.preview %}
              <p style="opacity:.8; margin:6px 0 0;">{{ r.preview }}</p>
            {% endif %}
          </a>
        {% endfor %}
      </div>
    {% endif %}

    <div class="pagination">
      {% if page > 1 %}
        <a href="/recipes?page={{ page-1 }}&per_page={{ per_page }}{% if q %}&q={{ q|urlencode }}{% endif %}">‹ Prev</a>
      {% else %}
        <span>‹ Prev</span>
      {% endif %}
      <span class="current">Page {{ page }}</span>
      {% if has_more %}
        <a href="/recipes?page={{ page+1 }}&per_page={{ per_page }}{% if q %}&q={{ q|urlencode }}{% endif %}">Next ›</a>
      {% else %}
        <span>Next ›</span>
      {% endif %}
    </div>
  </body>
</html>
